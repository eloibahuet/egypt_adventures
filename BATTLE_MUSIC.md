# 🎵 戰鬥音樂系統已實作完成

## ✅ 新增功能

### 雙音軌系統
現在遊戲有兩種不同的音樂：

1. **探索音樂** (Egypt_Stage_32bars)
   - 速度：Q:160（較慢、悠閒）
   - 音色：三角波（柔和、神秘）
   - 使用時機：正常探索、事件、休息

2. **戰鬥音樂** (Egypt_Battle_Full_32bars) ⚔️
   - 速度：Q:188（較快、緊張）
   - 音色：方波（尖銳、激烈）
   - 使用時機：遭遇敵人、進入戰鬥

## 🎮 自動切換邏輯

### 進入戰鬥時
```
遭遇敵人 → 自動切換到戰鬥音樂 🎵⚔️
```

### 戰鬥結束時
```
戰勝敵人 → 切換回探索音樂 🎵🏜️
逃跑成功 → 切換回探索音樂 🎵🏜️
玩家死亡 → 切換回探索音樂 🎵💀
```

## 🎼 音樂特性對比

### 探索音樂
- **節奏**：中等（160 BPM）
- **氛圍**：神秘、悠閒、探險
- **音色**：三角波（溫和）
- **包絡**：
  - 攻擊時間：20ms
  - 釋放時間：100ms
- **音量**：100%

### 戰鬥音樂
- **節奏**：快速（188 BPM）
- **氛圍**：緊張、激烈、戰鬥
- **音色**：方波（尖銳）
- **包絡**：
  - 攻擊時間：10ms（更快）
  - 釋放時間：50ms（更短）
- **音量**：80%（避免方波過於刺耳）

## 🎯 技術實作

### 音軌切換機制
```javascript
MusicSystem.switchTrack('battle')     // 切換到戰鬥音樂
MusicSystem.switchTrack('exploration') // 切換回探索音樂
```

### 特性
- ✅ 平滑切換（停止舊音樂 → 切換音軌 → 播放新音樂）
- ✅ 保持音量設定
- ✅ 保持開關狀態
- ✅ 100ms 延遲避免音訊衝突
- ✅ 控制台日誌顯示切換狀態

## 📊 音樂結構

### 戰鬥音樂結構（32小節）

**Section A (1-8)**：主題建立
- 快速的音符跳動（A2 C2 A2 C2）
- 建立緊張氛圍

**Section B (9-16)**：高潮發展
- 高音旋律（C'2 B2 A2 G2）
- 增加戰鬥緊張感

**Section C (17-24)**：轉折變化
- 音域變化（E2 F2 G2 A2）
- 保持動態感

**Section D (25-32)**：回歸與結束
- 回到主題（A4 C2 D2）
- 強力結束（A8）

## 🎵 音色對比效果

### 為什麼戰鬥用方波？
方波具有：
- 更尖銳的音色 → 突顯緊張感
- 更清晰的音符 → 強化節奏感
- 類似 8-bit 遊戲 → 復古戰鬥風格

### 為什麼探索用三角波？
三角波具有：
- 柔和的音色 → 舒適探索體驗
- 神秘的氛圍 → 符合埃及主題
- 較少刺耳感 → 適合長時間播放

## 🔊 音量平衡

戰鬥音樂音量設為 80% 的原因：
1. 方波天生較刺耳
2. 快速節奏需要降低音量
3. 避免玩家耳朵疲勞
4. 保持與探索音樂的平衡

## 🎮 測試方式

1. **開啟音樂**：點擊音樂按鈕
2. **正常探索**：聽到較慢、柔和的探索音樂
3. **遭遇戰鬥**：自動切換到快速、尖銳的戰鬥音樂
4. **戰鬥結束**：自動切換回探索音樂

## 📝 控制台日誌

音樂切換時會顯示：
```
🎵 Switched to battle music      // 切換到戰鬥音樂
🎵 Switched to exploration music // 切換回探索音樂
```

## 🎯 完美的遊戲體驗

現在你的遊戲有完整的音樂系統：
- ✅ 探索時：悠閒神秘的埃及旋律
- ✅ 戰鬥時：緊張激烈的戰鬥配樂
- ✅ 自動切換：無縫銜接
- ✅ 保持循環：持續播放不間斷

享受你的動態音樂系統！🎮🎵⚔️
